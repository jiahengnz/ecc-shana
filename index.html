<html>

<head>

</head>

<body>
  <h1>ECC SHana converter</h1>
  <p>Paste in ECC as csv</p>
  <div>
    <p>Input ECC</p>
    <textarea id="input" rows="25" cols="180"></textarea>
  </div>
  <div>
    <button type="button" onclick="convert()">Convert</button>
  </div>
  <div>
    <p>Read data</p>
    <textarea id="meta" rows="10" cols="180"></textarea>
  </div>
  <div>
    <p>Output SHana</p>
    <textarea id="output" rows="40" cols="180"></textarea>
  </div>
  <script>
    const eccSeparator = "\t";
    const fiscalYearLine = 0;
    const companyCodeLine = 1;
    const profitCenterLine = 3;
    const accountsLine = 4;
    function convert() {
      var input = document.getElementById("input").value;
      var lines = input.split("\n");

      let companyCode = lines[companyCodeLine].split(eccSeparator)[1];
      let profitCenter = lines[profitCenterLine].split(eccSeparator)[1];
      let nonZeroAccountsCount = 0;

      var output =
        "CATEGORY,RYEAR,POPER,RBUKRS,RCNTR,RACCT,KSL,RKCUR" + "\n" +
        "Plan Category,General Ledger Fiscal Year,Posting Period,Company Code,Cost Center,Account Number,Amount in Global Currency,Global Currency" + "\n" +
        "X,X,X,X,X,,,";

      if (!lines[accountsLine].startsWith("Account\t\t")) {
        window.alert("Error!");
        console.log(lines[accountsLine]);
        return;
      }

      for (var i = accountsLine + 1; i < lines.length - 1; i++) {
        var entry = lines[i].split(eccSeparator);
        if (entry[15] == '0') continue;
        nonZeroAccountsCount++;

        for (var month = 1; month <= 12; month++) {
          output += `\n,,${month},${companyCode},${profitCenter},${entry[0]},${entry[2 + month]},`;
        }

      }

      document.getElementById("meta").value =
        `Company code: ${companyCode}\nProfit center: ${profitCenter}
        \nNon-zero accounts found: ${nonZeroAccountsCount}`;

      document.getElementById("output").value = output;
    }

  </script>
</body>

</html>
